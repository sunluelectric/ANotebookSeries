%\chapterauthor{Author Name}{Author Affiliation}
%\chapterauthor{Second Author}{Second Author Affiliation}
\chapter{Files Management} \label{ch4}

File management is a big portion of OS functionality. In Linux, each device (such as a printer) is treated and managed as a file, and Linux uses a tree hierarchy to manage devices and files. This chapter introduces the filesystem hierarchy and commonly used file management commands.

\section{Filesystem Hierarchy Standard} \label{ch4sec:hierarchy}

The root directory is denoted by \verb|/|. All sub directories or files can be located by its full path, which looks like the following
\begin{lstlisting}
/<subdirectory>/<subsubdirectory>/.../<directoryname>
/<subdirectory>/<subsubdirectory>/.../<filename>
\end{lstlisting}
where the first \verb|/| in each row represents the root directory, and sequential \verb|/| represents entering a subdirectory.

Upon Linux installation, a file hierarchy is by default created under the root directory. A user can create new files under this hierarchy framework, but should not change the framework itself. The hierarchy is given in Fig. \ref{ch4fig:hierarchy}. Notice that ``\verb|/|'' in the figure, as introduced, stands for the root directory, and ``\verb|root|'' in the figure is a subdirectory under \verb|/| whose directory name is ``root'' and it is used store root user related documents. They are two different directories.

\begin{figure}
	\centering
	\includegraphics[width=250pt]{chapters/chapter4/figures/linux_file_hierarchy.png}
	\caption{Linux file system hierarchy.} \label{ch4fig:hierarchy}
\end{figure}

A (regular) user's home directory is often located at \verb|/home/<user name>|. When logging in as a regular user, his home directory is shorten by the tilde \verb|~| for convenience. Hence, for example \verb|ls ~| will list down the files and directories under his home directory.

As can be seen from Fig. \ref{ch4fig:hierarchy}, the hierarchy contains quite a few pre-determined subdirectories, each has some unique purpose. For convenience of illustration, these subdirectories are categorized by functionalities and depressibilities given in Fig. \ref{ch4fig:directorycate}. Notice that this categorization is rough and may not reflect the truth for all applications. For example, the commonly used command \verb|ls| may appear under \verb|/bin| or \verb|/usr/bin| depending on the Linux distributions.

\begin{figure}
	\centering
	\includegraphics[width=350pt]{chapters/chapter4/figures/linux_directory_cate.png}
	\caption{A rough categorization of commonly used directories in Linux file hierarchy standard.} \label{ch4fig:directorycate}
\end{figure}

A brief introduction to the directories are summarized in Table \ref{ch4tab:hierarchyintro}.

\begin{table}
  \centering \caption{Introduction to commonly used directories in Linux file hierarchy standard.}\label{ch4tab:hierarchyintro}
  \begin{tabularx}{\textwidth}{lX}
    \hline
    Directory & Description \\ \hline
    \verb|/bin|, \verb|/sbin| & Executables used by the OS, the administrator, and the regular users. \\ \hdashline
    \verb|/lib| & Libraries to support \verb|/bin| and \verb|/sbin|. \\ \hdashline
    \verb|/usr/bin|, \verb|/usr/sbin| & Executables used by the administrator and the regular users. \\ \hdashline
    \verb|/usr/lib| & Libraries to support \verb|/usr/bin| and \verb|/usr/sbin|. \\ \hdashline
    \verb|/opt| & Application software installed by OS and administrator for all users. \\ \hdashline
    \verb|/var| & Directories of data used by applications. \\ \hdashline
    \verb|/usr/local| & Application software installed by administrator for all users. \\ \hdashline
    \verb|/usr/share| & Architecture-independent sharable text files for applications. \\ \hdashline
    \verb|/usr/src| & Source files or packages managed by software manager. \\ \hdashline
    \verb|/dev| & Files representation of devices, such as CPU, RAM, hard disks. \\ \hdashline
    \verb|/media| & System mounts of removable media. \\ \hdashline
    \verb|/mnt| & Manual mounts of devices. \\ \hdashline
    \verb|/etc| & Configuration files for OS, users, and applications. \\ \hdashline
    \verb|/boot| & Linux bootable kernel and initial setups. \\ \hdashline
    \verb|/proc| & System resources information. \\ \hdashline
    \verb|/sys| & Linux kernel information, including a mirror of the kernel data structure. \\ \hdashline
    \verb|/tmp|, \verb|usr/tmp| & Temporary files. \\ \hdashline
    \verb|/root| & Root user's home directory. \\ \hdashline
    \verb|/home/<user name>| & A regular user's home directory, containing executables, configurations and files specifically belong to this user. \\
    \hline
  \end{tabularx}
\end{table}

Linux file hierarchy standard differs from MS-DOS and Windows in several ways. Firstly, Linux stores all files (regardless of their physical location) under root directory, while Windows uses drive letters such as \verb|C:\|, \verb|D:\| to distinguish different hard drives. Secondly, Linux uses slash (\verb|/|) to separate directory names, e.g. \verb|/home/username| while Windows uses back slash (\verb|\|), e.g. \verb|C:\Users\username|. Lastly, Linux uses ``magic numbers'' to tell file types and permissions and ownership to tell whether a file is executable, while Windows (almost always) uses suffixes to tell file types and distinguish executables. Distinguishing file types using magic numbers can be more reliable than using suffixes, though a bit less intuitive.

Magic numbers of a file refer to the first few bytes of a file that are unique to a particular file type, for example, PNG file is hex \verb|89 50 4e 47|. Linux compare the magic numbers of a file with an internal database to decide the file types and features.

\section{Commonly Used File Management Commands} \label{ch4sec:filemanagement}

Some of the most widely used file management commands are summarized in Table \ref{ch4tab:commonfilecommands}. Notice that \verb|chmod| and \verb|chown| are administration related commands that change the accessibility of a directory or a file, and will be introduced in a later sections together with the Linux permission system. The rest commands are categorized and introduced in the following subsections.

\begin{table}
  \centering \caption{Commonly used commands to navigate in the Linux file system.}\label{ch4tab:commonfilecommands}
  \begin{tabularx}{\textwidth}{lX}
    \hline
    Command & Description \\ \hline
    \verb|pwd| & Print working directory. \\ \hdashline
    \verb|ls| & List the subdirectories and files (and their detail information) in a given directory. \\ \hdashline
    \verb|touch| & Create an empty file. \\ \hdashline
    \verb|mkdir| & Create an empty subdirectory. \\ \hdashline
    \verb|mv| & Move (cut-and-paste) a directory or a file; change name of a directory or a file. \\ \hdashline
    \verb|cp| & Copy-and-paste a directory or a file. \\ \hdashline
    \verb|rm|, \verb|rmdir| & Remove a directory or a file (not to Trash, but just gone). \\ \hdashline
    \verb|chmod| & Change permission. \\ \hdashline
    \verb|chown| & Change ownership. \\
    \hline
  \end{tabularx}
\end{table}

\textbf{Print Working Directory}

As introduced earlier in Chapter \ref{ch2} Table \ref{ch2tab:shellenvironmentvars}, \verb|HOME|, \verb|PWD| and \verb|OLDPWD| are three default environmental variables used to store the home directory, the current directory and the previous directory of the shell, respectively. Therefore, to print the current working directory in the console, use command \verb|echo $PWD|. Alternatively, just use \verb|pwd| which has the safe effect, as follows.

\begin{lstlisting}
$ pwd
\end{lstlisting}

\textbf{List Information about the Files}

As one of the most frequently used commands, \verb|ls| lists down information about the files in the current directory (or any other directory if specified), and by default sort the entries alphabetically. Features can be specified for the items to be listed, to make the result more selective. The user is able to decide what information to be displayed, such as file name, file access control list, etc., as follows.
\begin{lstlisting}
$ ls [OPTION] [PATH]
\end{lstlisting}

An example is given in Fig. \ref{ch4fig:lscommandexample} below. By default, command \verb|ls| alone shows only the name of files and subdirectories (excluding hidden files and subdirectories). With the additional arguments (option, as given in the syntax above), more information can be displayed. For example in Fig. \ref{ch4fig:lscommandexample}, the \verb|-l| argument displays the information in long listing mode, which includes the owner and access control list information. More details about files and directories access control list are given in later part of this section.

\begin{figure}
	\centering
	\includegraphics[width=350pt]{chapters/chapter4/figures/ls_command_example.png}
	\caption{List down information of files and subdirectories in the current working directory.} \label{ch4fig:lscommandexample}
\end{figure}

More information can be found by reading the \verb|ls| command manual, which is accessible via \verb|ls --help|. Some commonly used \verb|ls| arguments are summarized in Table \ref{ch4tab:lscommandargument}. It is also possible to use a combination of arguments in a single line of command. For example, \verb|ls -al| aggregates the effects of using \verb|ls -a| and \verb|ls -l|.

\begin{table}
  \centering \caption{Commonly used arguments and their effects for \textit{ls} command.}\label{ch4tab:lscommandargument}
  \begin{tabularx}{\textwidth}{lX}
    \hline
    Directory & Description \\ \hline
    \verb|-a|, \verb|--all| & Include hidden files and subdirectories in the display, including current directory ``\verb|.|'' and parent directory ``\verb|..|'' in the list. \\ \hdashline
    \verb|-A|, \verb|--almost-all| & Include hidden files and subdirectories in the display, excluding ``\verb|.|'' and ``\verb|..|''. \\ \hdashline
    \verb|-C|, \verb|--color[=WHEN]| & Colorize the output. \\ \hdashline
    \verb|-l| & Use a long listing format. \\ \hdashline
    \verb|-s|, \verb|--size| & Print the allocated size of each file, in blocks. \\ \hdashline
    \verb|-S| & Sort the displayed content. \\ \hdashline
    \verb|-t| & Sort by modification time. \\
    \hline
  \end{tabularx}
\end{table}

Notice that some Linux distributions may come by default an alias about \verb|ls|, which usually helps to displays the information in a clearer manner. For example, when \verb|ls='ls --color-auto'| is used, the displayed content will be colored based on the type of the files and subdirectories.

\textbf{Create an Empty or a Simple Text File}

To create an empty file in the current working directory, simply use \verb|touch| followed by the path of the file (including file name) as follows.
\begin{lstlisting}
$ touch [OPTION] [PATH]
\end{lstlisting}
For example,
\begin{lstlisting}
$ touch ~/test
\end{lstlisting}
will create an empty file ``\textit{test}'' under the user's home directory. If only the name of the file is given, it will by default create the file under the current working directory. Notice that if a file or subdirectory name starts with ``\verb|.|'', it will be treated as a hidden file or subdirectory automatically.

Multiple empty files will be created if multiple paths are given in the command separated by spaces.

To create a simple text file, such as a text file with a single line of contents inside, consider using \verb|echo| command with \verb|>| as follows. It is more convenient than using \textit{Vim} for the same task, although also possible.
\begin{lstlisting}
$ echo 'content' > [PATH]
\end{lstlisting}
For example,
\begin{lstlisting}
$ echo '<html><body><h1>Hello world!</h1></body></html>' > ~/test.html
\end{lstlisting}
creates a simple static HTML web page that says ``Hello world!'' in the home directory.

\textbf{Create an Empty Directory}

Similar with \verb|touch|, use \verb|mkdir| followed by the path of the directory (including directory name) to create a directory as follows.
\begin{lstlisting}
$ mkdir [OPTION] [PATH]
\end{lstlisting}

\textbf{Move, Copy-and-Paste, and Remove Files and Directories}

To move a file or a directory from an existing PATH to a new PATH, simply use \verb|mv| command as follows.
\begin{lstlisting}
$ mv [OPTION] [SOURCE_PATH] [TARGET_PATH]
\end{lstlisting}
Different from the conventional cut-and-paste, while moving the item, it is possible to also rename the item simultaneously. For example,
\begin{lstlisting}
$ mv ~/dog.png ~/Pictures/puppy.png
\end{lstlisting}
will not only move the file \verb|dog.png| in the home directory to the subdirectory \verb|Pictures|, but also chance the file name to \verb|puppy.png|. For this reason, \verb|mv| can also be used to rename an item rather than moving the item, just by ``move'' it to the same directory but with a differen name.

Some commonly used arguments of \verb|mv| is summarized in Table \ref{ch4tab:mvcpcommandargument}, many of which concerns about the case where there is already an existing item with the identical name in the target path.

\begin{table}
  \centering \caption{Commonly used arguments and their effects for \textit{mv} and \textit{cp} command.}\label{ch4tab:mvcpcommandargument}
  \begin{tabularx}{\textwidth}{lX}
    \hline
    Directory & Description \\ \hline
    \verb|-b| & Make a backup before overwrite. \\ \hdashline
    \verb|-u| & Overwrite only when source target item is newer than the target path item. \\ \hdashline
    \verb|-i| & Prompt before overwrite. \\ \hdashline
    \verb|-f| & Do not prompt before overwrite. \\ 
    \hline
  \end{tabularx}
\end{table}

The copy-and-paste command \verb|cp| works similar with the move command \verb|mv|, except that it will not remove the item from the source path. Similar syntax applies to \verb|cp| as follows, and arguments in Table \ref{ch4tab:mvcpcommandargument} also apply to \verb|cp|.
\begin{lstlisting}
$ cp [OPTION] [SOURCE_PATH] [TARGET_PATH]
\end{lstlisting}

To permanently delete an item, use \verb|rm| command as follows.
\begin{lstlisting}
$ rm [OPTION] [PATH]
\end{lstlisting}
For safety, usualy when using \verb|rm|, the OS will keep prompting messages asking user to confirm whether to permenantly delete an item or not. In some OS setups, it is by default forbidden to delete a directory, unless all files and subdirectories in that file have been priorily removed. The following arguments in Table \ref{ch4tab:rmcommandargument} can be used to change the setup.

\begin{table}
  \centering \caption{Commonly used arguments and their effects for \textit{rm} command.}\label{ch4tab:rmcommandargument}
  \begin{tabularx}{\textwidth}{lX}
    \hline
    Directory & Description \\ \hline
    \verb|-f| & Ignore nonexistent files and arguments and do not prompt. \\ \hdashline
    \verb|-r| & Remove directories and their contents recursively. \\ \hdashline
    \verb|-i| & Prompt before every removal. \\ \hdashline
    \verb|-d| & Remove empty directories. \\
    \hline
  \end{tabularx}
\end{table}

It is possible though, that removed items using \verb|rm| be recovered by expertise. For greater assurance that the deleted contents are truly unrecoverable, consider using \verb|shred| which can physically overwrite a specified hard drive.

















\section{Access Control List}


